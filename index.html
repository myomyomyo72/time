<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>é–¢è¥¿é›»è»Šæ™‚åˆ»è¡¨</title>
  <style>
    /* ------- å…±é€šãƒªã‚»ãƒƒãƒˆ ------- */
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh; padding:10px;
    }
    /* ------- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ ------- */
    .container{
      max-width:800px; margin:0 auto; background:rgba(255,255,255,.95);
      border-radius:20px; padding:20px; box-shadow:0 20px 40px rgba(0,0,0,.1);
      backdrop-filter:blur(10px);
    }
    h1{ text-align:center; color:#333; margin-bottom:20px; font-size:24px; font-weight:700; }
    .current-time{
      text-align:center; font-size:18px; color:#666; margin-bottom:20px;
      padding:10px; background:rgba(102,126,234,.1); border-radius:10px;
    }
    .route-section{ margin-bottom:25px; border:2px solid #e0e0e0; border-radius:15px; overflow:hidden; }
    .route-header{
      background:linear-gradient(90deg,#667eea,#764ba2); color:#fff;
      padding:15px; font-weight:bold; text-align:center; font-size:16px;
    }
    .timetable-container{ display:grid; grid-template-columns:1fr 1fr; gap:15px; padding:15px; }
    .timetable-section{
      background:#f8f9fa; border-radius:10px; padding:15px;
      box-shadow:0 2px 8px rgba(0,0,0,.05);
    }
    .section-title{
      font-weight:bold; margin-bottom:10px; color:#333; font-size:14px;
      border-bottom:2px solid #667eea; padding-bottom:5px;
    }
    .time-item{
      display:flex; justify-content:space-between; align-items:center;
      padding:8px 12px; margin:5px 0; background:#fff; border-radius:8px;
      border-left:4px solid #667eea; box-shadow:0 1px 3px rgba(0,0,0,.1);
      transition:.2s;
    }
    .time-item:hover{ transform:translateY(-1px); box-shadow:0 2px 6px rgba(0,0,0,.15); }
    .time{ font-weight:bold; color:#333; font-size:16px; }
    .train-type{
      background:#667eea; color:#fff; padding:2px 6px; border-radius:4px;
      font-size:11px; font-weight:bold;
    }
    .train-type.express{ background:#e74c3c; }
    .train-type.rapid{   background:#f39c12; }
    .train-type.local{   background:#27ae60; }
    .error{
      text-align:center; padding:20px; color:#e74c3c; background:#fff5f5;
      border-radius:8px; margin:10px 0;
    }
    .refresh-btn{
      background:linear-gradient(45deg,#667eea,#764ba2); color:#fff; border:none;
      padding:12px 24px; border-radius:25px; font-size:16px; font-weight:bold;
      cursor:pointer; display:block; margin:20px auto; transition:.3s;
      box-shadow:0 4px 15px rgba(102,126,234,.4);
    }
    .refresh-btn:hover{ transform:translateY(-2px); box-shadow:0 6px 20px rgba(102,126,234,.6); }
    @media(max-width:600px){
      .timetable-container{ grid-template-columns:1fr; }
      .container{ padding:15px; margin:5px; }
      h1{ font-size:20px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>ğŸšƒ é–¢è¥¿é›»è»Šæ™‚åˆ»è¡¨</h1>
    <div id="currentTime" class="current-time"></div>

    <!-- è¥¿å¤§è·¯ â†’ å¤§é˜ª -->
    <div class="route-section">
      <div class="route-header">è¥¿å¤§è·¯é§… â†’ å¤§é˜ªé§…</div>
      <div class="timetable-container">
        <div class="timetable-section">
          <div class="section-title">å¤§é˜ªæ–¹é¢ ç›´é€š</div>
          <div id="nishioji-osaka-direct"></div>
        </div>
        <div class="timetable-section">
          <div class="section-title">äº¬éƒ½é§…çµŒç”±</div>
          <div id="nishioji-kyoto-connection"></div>
        </div>
      </div>
    </div>

    <!-- å¤§é˜ª â†’ è¥¿å¤§è·¯ -->
    <div class="route-section">
      <div class="route-header">å¤§é˜ªé§… â†’ è¥¿å¤§è·¯é§…</div>
      <div class="timetable-container">
        <div class="timetable-section">
          <div class="section-title">è¥¿å¤§è·¯æ–¹é¢ ç›´é€š</div>
          <div id="osaka-nishioji-direct"></div>
        </div>
        <div class="timetable-section">
          <div class="section-title">äº¬éƒ½é§…çµŒç”±</div>
          <div id="osaka-kyoto-connection"></div>
        </div>
      </div>
    </div>

    <button class="refresh-btn" onclick="refreshTimetables()">ğŸ”„ æ›´æ–°</button>
  </div>

  <script>
    /* ----------- ã‚µãƒ³ãƒ—ãƒ«æ™‚åˆ»è¡¨ãƒ‡ãƒ¼ã‚¿ï¼ˆå¾Œæ—¥ JSON ã«ç½®æ›å¯ï¼‰ ----------- */
    const timetableData = { /* ã“ã“ã¯è³ªå•ã«è¼‰ã›ã¦ã„ãŸã ã„ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨åŒã˜ */ };

    /* ----------- æ—¥æ™‚é–¢é€£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ----------- */
    function updateCurrentTime(){
      const now   = new Date();
      const text  = now.toLocaleString('ja-JP',{
        year:'numeric',month:'2-digit',day:'2-digit',
        hour:'2-digit',minute:'2-digit',second:'2-digit',
        weekday:'short'
      });
      document.getElementById('currentTime').textContent = `ç¾åœ¨æ™‚åˆ»: ${text}`;
    }
    function timeToMinutes(str){
      const [h,m] = str.split(':').map(Number);
      return h*60+m;
    }

    /* ----------- ç›´è¿‘åˆ—è»ŠæŠ½å‡º ----------- */
    function getNearbyTrains(list,currentMins,count=4){
      const upcoming = list.filter(t=>timeToMinutes(t.time)>=currentMins);
      const past     = list.filter(t=>timeToMinutes(t.time)< currentMins);
      return upcoming.length>=count
        ? upcoming.slice(0,count)
        : [...past.slice(- (count-upcoming.length)),...upcoming];
    }

    /* ----------- è¡¨ç¤ºãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ----------- */
    function getTrainTypeClass(type){
      if(type.includes('æ–°å¿«é€Ÿ')) return 'express';
      if(type.includes('å¿«é€Ÿ'))  return 'rapid';
      return 'local';
    }
    function displayTimetable(elId,trains){
      const el = document.getElementById(elId);
      if(!trains.length){
        el.innerHTML = '<div class="error">æ™‚åˆ»è¡¨ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      el.innerHTML = trains.map(t=>`
        <div class="time-item">
          <span class="time">${t.time}</span>
          <span class="train-type ${getTrainTypeClass(t.type)}">${t.type}</span>
        </div>
      `).join('');
    }

    /* ----------- ä¹—æ›è¡¨ç¤º ----------- */
    function displayConnectionTimetable(elId,fromList,toList,transfer=2){
      const nowMins  = timeToMinutes(new Date().toTimeString().slice(0,5));
      const connections = [];

      fromList.forEach(f=>{
        const connTime = timeToMinutes(f.time)+transfer;
        const to = toList.find(t=>timeToMinutes(t.time)>=connTime);
        if(to){
          connections.push({
            /* â–¼ è¿½åŠ ï¼šgetNearbyTrains ãŒå‚ç…§ã™ã‚‹ time */
            time        : f.time,
            departure   : f.time,
            arrival     : to.time,
            depType     : f.type,
            arrType     : to.type
          });
        }
      });

      const list = getNearbyTrains(connections,nowMins,4);
      const el   = document.getElementById(elId);
      el.innerHTML = list.map(c=>`
        <div class="time-item">
          <div>
            <div class="time">${c.departure} â†’ ${c.arrival}</div>
            <small style="opacity:.7;">äº¬éƒ½é§…ç™º ${c.arrival}</small>
          </div>
          <span class="train-type ${getTrainTypeClass(c.arrType)}">${c.arrType}</span>
        </div>
      `).join('');
    }

    /* ----------- ãƒ¡ã‚¤ãƒ³æ›´æ–°å‡¦ç† ----------- */
    function refreshTimetables(){
      const nowMins = timeToMinutes(new Date().toTimeString().slice(0,5));

      displayTimetable('nishioji-osaka-direct',
        getNearbyTrains(timetableData.nishiojiToOsaka,nowMins));

      displayConnectionTimetable('nishioji-kyoto-connection',
        timetableData.nishiojiToKyoto,timetableData.kyotoToOsaka);

      displayTimetable('osaka-nishioji-direct',
        getNearbyTrains(timetableData.osakaToNishioji,nowMins));

      displayConnectionTimetable('osaka-kyoto-connection',
        timetableData.osakaToKyoto,timetableData.kyotoToNishioji);
    }

    /* ----------- åˆæœŸåŒ– ----------- */
    function init(){
      updateCurrentTime();
      refreshTimetables();
      /* 1 åˆ†ã”ã¨ã«è‡ªå‹•æ›´æ–° */
      setInterval(()=>{ updateCurrentTime(); refreshTimetables(); },60000);
    }
    /* ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ */
    window.onload = init;
  </script>
</body>
</html>
